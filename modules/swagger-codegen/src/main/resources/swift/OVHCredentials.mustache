//  OVHCredentials.swift
//
//  Generated by swagger-codegen
//  Copyright Â© 2016 OVH SAS. All rights reserved.
//

import Foundation
import CryptoSwift

final public class OVHCredentials {

    static public let applicationHeaderName = "X-Ovh-Application"
    static public let consumerHeaderName = "X-Ovh-Consumer"
    static public let timestampHeaderName = "X-Ovh-Timestamp"
    static public let signatureHeaderName = "X-Ovh-Signature"

    static public let sharedCredentials = OVHCredentials()

    public var applicationKey: String?
    public var applicationSecret: String?
    public var consumerKey: String?

    public func getAuthenticationHeadersWithSignature(signed: Bool, url: String?, method: String?, andBody body: String?) -> [String:String]? {
        if !signed {
            if let applicationKey = applicationKey {
                return [OVHCredentials.applicationHeaderName: applicationKey]
            }
        } else {
            if let applicationKey = applicationKey, applicationSecret = applicationSecret, consumerKey = consumerKey, url = url, method = method, body = body {
                let timestamp = String(Int(NSDate().timeIntervalSince1970))
                let toSign = "\(applicationSecret)+\(consumerKey)+\(method)+\(url)+\(body)+\(timestamp)"
                let signature = "$1$\(toSign.sha1())"
                return [OVHCredentials.applicationHeaderName: applicationKey, OVHCredentials.consumerHeaderName: consumerKey, OVHCredentials.timestampHeaderName: timestamp, OVHCredentials.signatureHeaderName: signature]
            }
        }

        return nil
    }
}
